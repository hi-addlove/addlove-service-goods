<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.addlove.service.goods.dao.DstRtnApplyDao">
  <resultMap id="BaseResultMapHead" type="com.addlove.service.goods.model.DstRtnApplyHeadModel">
    <id column="BILLNO" jdbcType="VARCHAR" property="billNo" />
    <result column="LRDATE" jdbcType="TIMESTAMP" property="lrDate" />
    <result column="USERID" jdbcType="NUMERIC" property="userId" />
    <result column="USERCODE" jdbcType="VARCHAR" property="userCode" />
    <result column="USERNAME" jdbcType="VARCHAR" property="userName" />
    <result column="GENTYPE" jdbcType="VARCHAR" property="genType" />
    <result column="ORGCODE" jdbcType="VARCHAR" property="orgCode" />
    <result column="ORGNAME" jdbcType="VARCHAR" property="orgName" />
    <result column="INORGCODE" jdbcType="VARCHAR" property="inOrgCode" />
    <result column="DEPID" jdbcType="NUMERIC" property="depId" />
    <result column="DEPCODE" jdbcType="VARCHAR" property="depCode" />
    <result column="DEPNAME" jdbcType="VARCHAR" property="depName" />
    <result column="ORGTYPE" jdbcType="VARCHAR" property="orgType" />
    <result column="THORGCODE" jdbcType="VARCHAR" property="thOrgCode" />
    <result column="THORGNAME" jdbcType="VARCHAR" property="thOrgnNme" />
    <result column="INTHORGCODE" jdbcType="VARCHAR" property="inThOrgCode" />
     <result column="CNTID" jdbcType="NUMERIC" property="cntId" />
    <result column="HTCODE" jdbcType="VARCHAR" property="htCode" />
    <result column="HTNAME" jdbcType="VARCHAR" property="htName" />
    <result column="THCOUNT" jdbcType="NUMERIC" property="thCount" />
    <result column="THTOTAL" jdbcType="NUMERIC" property="thTotal" />
    <result column="JYMODE" jdbcType="VARCHAR" property="jyMode" />
    <result column="JSCODE" jdbcType="VARCHAR" property="jsCode" />
     <result column="JZDATE" jdbcType="TIMESTAMP" property="jzDate" />
    <result column="JZRID" jdbcType="NUMERIC" property="jzrId" />
    <result column="JZRCODE" jdbcType="VARCHAR" property="jzrCode" />
    <result column="JZRNAME" jdbcType="VARCHAR" property="jzrName" />
    <result column="RPTDATE" jdbcType="VARCHAR" property="rptDate" />
    <result column="PRNTIMES" jdbcType="NUMERIC" property="prnTimes" />
    <result column="PRNDATE" jdbcType="TIMESTAMP" property="prnDate" />
    <result column="TIMEMARK" jdbcType="NUMERIC" property="timeMark" />
    <result column="YWTYPE" jdbcType="VARCHAR" property="ywType" />
    <result column="YWIOTYPE" jdbcType="VARCHAR" property="ywIoType" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="JZTYPE" jdbcType="VARCHAR" property="jzType" />
    <result column="DATASTATUS" jdbcType="VARCHAR" property="dataStatus" />
    <result column="CKCODE" jdbcType="VARCHAR" property="ckCode" />
    <result column="CKNAME" jdbcType="VARCHAR" property="ckName" />
    <result column="THREASON" jdbcType="VARCHAR" property="thReason" />
    <result column="WTHTOTAL" jdbcType="NUMERIC" property="wThTotal" />
    <result column="XTAXTOTAL" jdbcType="NUMERIC" property="xTaxTotal" />
    <result column="PLNTHDATE" jdbcType="VARCHAR" property="plnThDate" />
    <result column="WLAREACODE" jdbcType="VARCHAR" property="wlAreaCode" />
    <result column="WLAREANAME" jdbcType="VARCHAR" property="wlAreaName" />
    <result column="STOTAL" jdbcType="NUMERIC" property="sTotal" />
    <result column="SHTYPE" jdbcType="VARCHAR" property="shType" />
    <result column="CURRCODE" jdbcType="VARCHAR" property="currCode" />
    <result column="EXCHANGERATE" jdbcType="NUMERIC" property="exchangeRate" />
    <result column="STLCURRTHTOTAL" jdbcType="NUMERIC" property="stlCurrThTotal" />
    <result column="ISSTDCURR" jdbcType="VARCHAR" property="isstdcurr" />
    <result column="FHBILLNO" jdbcType="VARCHAR" property="fhbillno" />
    <result column="DATASRC" jdbcType="VARCHAR" property="datasrc" />
    <result column="BILLSTATUS" jdbcType="VARCHAR" property="billStatus" />
    <result column="ZBCHECKDATE" jdbcType="TIMESTAMP" property="zbcheckdate" />
    <result column="ZBCHECKRID" jdbcType="NUMERIC" property="zbcheckrid" />
    <result column="ZBCHECKRCODE" jdbcType="VARCHAR" property="zbcheckrcode" />
    <result column="ZBCHECKRNAME" jdbcType="VARCHAR" property="zbcheckrname" />
    <result column="WLCHECKDATE" jdbcType="TIMESTAMP" property="wlcheckdate" />
    <result column="WLCHECKRID" jdbcType="NUMERIC" property="wlcheckrid" />
    <result column="WLCHECKRCODE" jdbcType="VARCHAR" property="wlcheckrcode" />
    <result column="WLCHECKRNAME" jdbcType="VARCHAR" property="wlcheckrname" />
    <result column="ZBCHECKCOUNT" jdbcType="NUMERIC" property="zbCheckCount" />
    <result column="WLCHECKCOUNT" jdbcType="NUMERIC" property="wlCheckCount" />
    <result column="REMARK1" jdbcType="VARCHAR" property="remark1" />
    <result column="REMARK2" jdbcType="VARCHAR" property="remark2" />
    <result column="REMARK3" jdbcType="VARCHAR" property="remark3" />
    <result column="ADLPSTHSQTYPE" jdbcType="VARCHAR" property="adlPsThSqType" />
  </resultMap>
  
  <resultMap id="BaseResultMapBody" type="com.addlove.service.goods.model.DstRtnApplyBodyModel">
    <id column="BILLNO" jdbcType="VARCHAR" property="billNo" />
    <id column="SERIALNO" jdbcType="NUMERIC" property="serialNo" />
    <result column="PLUID" jdbcType="NUMERIC" property="pluId" />
    <result column="PLUCODE" jdbcType="VARCHAR" property="pluCode" />
    <result column="PLUNAME" jdbcType="VARCHAR" property="pluName" />
    <result column="BARCODE" jdbcType="VARCHAR" property="barCode" />
    <result column="EXPLUCODE" jdbcType="VARCHAR" property="exPluCode" />
    <result column="EXPLUNAME" jdbcType="VARCHAR" property="exPluName" />
    <result column="SPEC" jdbcType="VARCHAR" property="spec" />
    <result column="UNIT" jdbcType="VARCHAR" property="unit" />
    <result column="THPRICE" jdbcType="NUMERIC" property="thPrice" />
    <result column="PACKUNIT" jdbcType="VARCHAR" property="packUnit" />
    <result column="PACKQTY" jdbcType="NUMERIC" property="packQty" />
    <result column="PACKCOUNT" jdbcType="NUMERIC" property="packCount" />
    <result column="SGLCOUNT" jdbcType="NUMERIC" property="sglCount" />
    <result column="THCOUNT" jdbcType="NUMERIC" property="thCount" />
    <result column="THTOTAL" jdbcType="NUMERIC" property="thTotal" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="DEPID" jdbcType="NUMERIC" property="depId" />
    <result column="PLUTYPE" jdbcType="VARCHAR" property="pluType" />
    <result column="SCDATE" jdbcType="VARCHAR" property="scDate" />
    <result column="BZDAYS" jdbcType="NUMERIC" property="bzDays" />
    <result column="THREASON" jdbcType="VARCHAR" property="thReason" />
    <result column="WTHPRICE" jdbcType="NUMERIC" property="wThPrice" />
    <result column="WTHTOTAL" jdbcType="NUMERIC" property="wThTotal" />
    <result column="XTAXRATE" jdbcType="NUMERIC" property="xTaxRate" />
    <result column="XTAXTOTAL" jdbcType="NUMERIC" property="xTaxTotal" />
    <result column="PLNCOUNT" jdbcType="NUMERIC" property="plnCount" />
    <result column="ISTH" jdbcType="VARCHAR" property="isTh" />
    <result column="KWCODE" jdbcType="VARCHAR" property="kwCode" />
    <result column="PRICE" jdbcType="NUMERIC" property="price" />
    <result column="STOTAL" jdbcType="NUMERIC" property="sTotal" />
    <result column="STLCURRTHPRICE" jdbcType="NUMERIC" property="stlCurrThPrice" />
    <result column="STLCURRTHTOTAL" jdbcType="NUMERIC" property="stlCurrThTotal" />
    <result column="CARGONO" jdbcType="VARCHAR" property="cargono" />
    <result column="MATERIALCODE" jdbcType="VARCHAR" property="materialcode" />
    <result column="PIECECOUNT" jdbcType="VARCHAR" property="piececount" />
    <result column="CHGTYPE" jdbcType="VARCHAR" property="chgtype" />
    <result column="SCDATECTRL" jdbcType="VARCHAR" property="scdatectrl" />
    <result column="ZBCHECKCOUNT" jdbcType="NUMERIC" property="zbcheckcount" />
    <result column="WLCHECKCOUNT" jdbcType="NUMERIC" property="wlcheckcount" />
  </resultMap>
  
  <resultMap id="BaseResultMapFl" type="com.addlove.service.goods.model.BasFlContentModel">
    <id column="FLCODE" jdbcType="VARCHAR" property="flCode" />
    <id column="LXCODE" jdbcType="VARCHAR" property="lxCode" />
    <result column="LXNAME" jdbcType="VARCHAR" property="lxName" />
    <result column="LXTYPE" jdbcType="VARCHAR" property="lxType" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
  </resultMap>
  
  <resultMap id="BaseResultMapSkuEx" type="com.addlove.service.goods.model.SkuPluExtendModel">
    <result column="PLUID" jdbcType="NUMERIC" property="pluId" />
    <result column="PLUCODE" jdbcType="VARCHAR" property="pluCode" />
    <result column="PLUNAME" jdbcType="VARCHAR" property="pluName" />
    <result column="PLUENAME" jdbcType="VARCHAR" property="pluEName" />
    <result column="PLUABBRNAME" jdbcType="VARCHAR" property="pluAbbrName" />
    <result column="PLUMN" jdbcType="VARCHAR" property="plumn" />
    <result column="BARCODE" jdbcType="VARCHAR" property="barCode" />
    <result column="UNIT" jdbcType="VARCHAR" property="unit" />
    <result column="SPEC" jdbcType="VARCHAR" property="spec" />
    <result column="PLUWEIGHT" jdbcType="NUMERIC" property="pluWeight" />
    <result column="PLUHEIGHT" jdbcType="NUMERIC" property="pluHeight" />
    <result column="PLULONG" jdbcType="NUMERIC" property="pluLong" />
    <result column="PLUWIDTH" jdbcType="NUMERIC" property="pluWidth" />
    <result column="ISMULPACKET" jdbcType="VARCHAR" property="isMulPacket" />
    <result column="ORGCODE" jdbcType="VARCHAR" property="orgCode" />
    <result column="ORGNAME" jdbcType="VARCHAR" property="orgName" />
    <result column="CGYID" jdbcType="NUMERIC" property="cgyId" />
    <result column="CGYCODE" jdbcType="VARCHAR" property="cgyCode" />
    <result column="CGYNAME" jdbcType="VARCHAR" property="cgyName" />
    <result column="CARGONO" jdbcType="VARCHAR" property="carGoNo" />
    <result column="PRODUCE" jdbcType="VARCHAR" property="produce" />
    <result column="GRADE" jdbcType="VARCHAR" property="grade" />
    <result column="QUALITY" jdbcType="VARCHAR" property="quality" />
    <result column="ISSEASON" jdbcType="VARCHAR" property="isSeason" />
    <result column="SALESEASON" jdbcType="VARCHAR" property="saleSeason" />
    <result column="BZDAYS" jdbcType="NUMERIC" property="bzDays" />
    <result column="CLSID" jdbcType="NUMERIC" property="clsId" />
    <result column="BRANDCODE" jdbcType="VARCHAR" property="brandCode" />
    <result column="JTAXCALTYPE" jdbcType="VARCHAR" property="jTaxCalType" />
    <result column="WJPRICE" jdbcType="NUMERIC" property="wjPrice" />
    <result column="HJPRICE" jdbcType="NUMERIC" property="hjPrice" />
    <result column="JTAXRATE" jdbcType="NUMERIC" property="jTaxRate" />
    <result column="PRICE" jdbcType="NUMERIC" property="price" />
    <result column="XTAXRATE" jdbcType="NUMERIC" property="xTaxRate" />
    <result column="PROMDECIMAL" jdbcType="NUMERIC" property="promDecimal" />
    <result column="PROMFORMULA" jdbcType="VARCHAR" property="promFormula" />
    <result column="DOTDECIMAL" jdbcType="NUMERIC" property="dotDecimal" />
    <result column="ISWEIGHT" jdbcType="VARCHAR" property="isWeight" />
    <result column="ISCOUTQTY" jdbcType="VARCHAR" property="isCoutQty" />
    <result column="ISSELFBRAND" jdbcType="VARCHAR" property="isSelfBrand" />
    <result column="ISKC" jdbcType="VARCHAR" property="isKc" />
    <result column="ISFRESH" jdbcType="VARCHAR" property="isFresh" />
    <result column="ISEXPLUCODE" jdbcType="VARCHAR" property="isExPluCode" />
    <result column="ISCURRDAY" jdbcType="VARCHAR" property="isCurrDay" />
    <result column="JHBFBZDAYS" jdbcType="NUMERIC" property="jhBfBzDays" />
    <result column="PSBFBZDAYS" jdbcType="NUMERIC" property="psBfBzDays" />
    <result column="ISNEWPLU" jdbcType="VARCHAR" property="isNewPlu" />
    <result column="ISACTIVE" jdbcType="VARCHAR" property="isActive" />
    <result column="CXINFO" jdbcType="VARCHAR" property="cxInfo" />
    <result column="YWSTATUS" jdbcType="VARCHAR" property="ywStatus" />
    <result column="LRDATE" jdbcType="VARCHAR" property="lrDate" />
    <result column="LRUSERID" jdbcType="NUMERIC" property="lrUserId" />
    <result column="LRUSERCODE" jdbcType="VARCHAR" property="lrUserCode" />
    <result column="LRUSERNAME" jdbcType="VARCHAR" property="lrUserName" />
    <result column="ZXDATE" jdbcType="VARCHAR" property="zxDate" />
    <result column="ZXUSERID" jdbcType="NUMERIC" property="zxUserId" />
    <result column="ZXUSERCODE" jdbcType="VARCHAR" property="zxUserCode" />
    <result column="ZXUSERNAME" jdbcType="VARCHAR" property="zxUserName" />
    <result column="UDP1" jdbcType="VARCHAR" property="udp1" />
    <result column="UDP2" jdbcType="VARCHAR" property="udp2" />
    <result column="UDP3" jdbcType="VARCHAR" property="udp3" />
    <result column="UDP4" jdbcType="VARCHAR" property="udp4" />
    <result column="UDP5" jdbcType="VARCHAR" property="udp5" />
    <result column="UDP6" jdbcType="VARCHAR" property="udp6" />
    <result column="UDP7" jdbcType="VARCHAR" property="udp7" />
    <result column="UDP8" jdbcType="VARCHAR" property="udp8" />
    <result column="UDP9" jdbcType="VARCHAR" property="udp9" />
    <result column="DATASTATUS" jdbcType="VARCHAR" property="dataStatus" />
    <result column="HYPRICE" jdbcType="NUMERIC" property="hyPrice" />
    <result column="PLUCLS" jdbcType="VARCHAR" property="pluCls" />
    <result column="PLUMODEL" jdbcType="VARCHAR" property="pluModel" />
    <result column="UDP10" jdbcType="VARCHAR" property="udp10" />
    <result column="UDP11" jdbcType="VARCHAR" property="udp11" />
    <result column="UDP12" jdbcType="VARCHAR" property="udp12" />
    <result column="UDP13" jdbcType="VARCHAR" property="udp13" />
    <result column="UDP14" jdbcType="VARCHAR" property="udp14" />
    <result column="MATERIALCODE" jdbcType="VARCHAR" property="materialCode" />
    <result column="LRORGCODE" jdbcType="VARCHAR" property="lrOrgCode" />
    <result column="LRORGNAME" jdbcType="VARCHAR" property="lrOrgName" />
    <result column="DATASRC" jdbcType="VARCHAR" property="dataSrc" />
    <result column="MINTHDAYS" jdbcType="NUMERIC" property="minThDays" />
    <result column="MAXTHDAYS" jdbcType="NUMERIC" property="maxThDays" />
    <result column="ISONLINE" jdbcType="VARCHAR" property="isOnline" />
    <result column="LINEDATE" jdbcType="VARCHAR" property="lineDate" />
    <result column="PLUDESC" jdbcType="VARCHAR" property="pluDesc" />
    <result column="EXPLUCODE" jdbcType="VARCHAR" property="exPluCode" />
    <result column="KCCOUNT" jdbcType="VARCHAR" property="kcCount" />
    <result column="HCOST" jdbcType="VARCHAR" property="hCost" />
    <result column="WCOST" jdbcType="VARCHAR" property="wCost" />
    <result column="PLUTYPE" jdbcType="VARCHAR" property="pluType" />
    <result column="PACKQTY" jdbcType="VARCHAR" property="packQty" />
  </resultMap>
  
  <sql id="Base_Column_List_Head">
    BILLNO, LRDATE, USERID, USERCODE, USERNAME, GENTYPE, ORGCODE, ORGNAME, INORGCODE, 
    DEPID, DEPCODE, DEPNAME, ORGTYPE, THORGCODE, THORGNAME, INTHORGCODE, CNTID, HTCODE, 
    HTNAME, THCOUNT, THTOTAL, JYMODE, JSCODE, JZDATE, JZRID, JZRCODE, JZRNAME, RPTDATE, 
    PRNTIMES, PRNDATE, TIMEMARK, YWTYPE, YWIOTYPE, REMARK, JZTYPE, DATASTATUS, CKCODE, 
    CKNAME, THREASON, WTHTOTAL, XTAXTOTAL, PLNTHDATE, WLAREACODE, WLAREANAME, STOTAL, 
    SHTYPE, CURRCODE, EXCHANGERATE, STLCURRTHTOTAL, ISSTDCURR, FHBILLNO, DATASRC, BILLSTATUS, 
    ZBCHECKDATE, ZBCHECKRID, ZBCHECKRCODE, ZBCHECKRNAME, WLCHECKDATE, WLCHECKRID, WLCHECKRCODE, 
    WLCHECKRNAME, ZBCHECKCOUNT, WLCHECKCOUNT, REMARK1, REMARK2, REMARK3, ADLPSTHSQTYPE
  </sql>
  
  <sql id="Base_Column_List_Body">
    BILLNO, SERIALNO, PLUID, PLUCODE, PLUNAME, BARCODE, EXPLUCODE, EXPLUNAME, SPEC, UNIT, 
    THPRICE, PACKUNIT, PACKQTY, PACKCOUNT, SGLCOUNT, THCOUNT, THTOTAL, REMARK, DEPID, 
    PLUTYPE, SCDATE, BZDAYS, THREASON, WTHPRICE, WTHTOTAL, XTAXRATE, XTAXTOTAL, PLNCOUNT, 
    ISTH, KWCODE, PRICE, STOTAL, STLCURRTHPRICE, STLCURRTHTOTAL, CARGONO, MATERIALCODE, 
    PIECECOUNT, CHGTYPE, SCDATECTRL, ZBCHECKCOUNT, WLCHECKCOUNT
  </sql>
  
  <!-- 查询领用单列表 -->
  <select id="queryRtnPage" resultMap="BaseResultMapHead">
    Select Distinct t.BILLNO,
                t.LRDATE,
                t.USERID,
                t.USERCODE,
                t.USERNAME,
                t.GENTYPE, 
                t.ORGCODE, 
                t.ORGNAME, 
                t.INORGCODE, 
                t.DEPID, 
                t.DEPCODE, 
                t.DEPNAME, 
                t.ORGTYPE, 
                t.THORGCODE, 
                t.THORGNAME, 
                t.INTHORGCODE, 
                t.CNTID, 
                t.HTCODE, 
                t.HTNAME, 
                t.THCOUNT, 
                t.THTOTAL, 
                t.JZDATE, 
                t.JZRID, 
                t.JZRCODE, 
                t.JZRNAME,
                t.YWTYPE,
                t.REMARK, 
                t.DATASTATUS, 
                t.CKCODE, 
                t.CKNAME, 
                t.THREASON, 
                t.WTHTOTAL, 
                t.XTAXTOTAL, 
                t.PLNTHDATE,
                t.STOTAL, 
                t.STLCURRTHTOTAL,
                t.BILLSTATUS, 
                t.ZBCHECKCOUNT, 
                t.WLCHECKCOUNT,
                t.ADLPSTHSQTYPE
    From TDSTRTNAPPLYHEAD t Where t.THORGCODE = #{queryModel.orgCode,jdbcType=VARCHAR}
    <if test="queryModel.billNo != '' and queryModel.billNo != null">
        and t.BILLNO LIKE CONCAT(#{queryModel.billNo,jdbcType=VARCHAR},'%')
    </if>
    <if test="queryModel.startDate != '' and queryModel.startDate != null">
        and t.LRDATE &gt;= to_date(#{queryModel.startDate,jdbcType=VARCHAR},'yyyy-MM-dd HH24:mi:ss')
    </if>
    <if test="queryModel.endDate != '' and queryModel.endDate != null">
        and t.LRDATE &lt;= to_date(#{queryModel.endDate,jdbcType=VARCHAR},'yyyy-MM-dd HH24:mi:ss')
    </if>
    <if test="queryModel.dataStatus != null and queryModel.dataStatus != '' ">
        and t.DATASTATUS = #{queryModel.dataStatus,jdbcType=VARCHAR}
    </if>
    <if test="queryModel.billStatus != null and queryModel.billStatus != '' ">
        and t.BILLSTATUS = #{queryModel.billStatus,jdbcType=VARCHAR}
    </if>
    <if test="queryModel.user != null and queryModel.user != '' ">
        and (
            t.USERCODE LIKE CONCAT(CONCAT('%',#{queryModel.user,jdbcType=VARCHAR}),'%') 
            or 
            t.USERNAME LIKE CONCAT(CONCAT('%',#{queryModel.user,jdbcType=VARCHAR}),'%')
        )
    </if>
    <if test="queryModel.depId != null ">
        and t.DEPID = #{queryModel.depId,jdbcType=VARCHAR}
    </if>
    <if test="queryModel.ckCode != null and queryModel.ckCode != '' ">
        and t.CKCODE = #{queryModel.ckCode,jdbcType=VARCHAR}
    </if>
  </select>
  
  <!-- 插入配送退货主表 -->
  <insert id="insertRtnHead">
    INSERT INTO TDSTRTNAPPLYHEAD
    (
        BILLNO, 
        LRDATE, 
        USERID, 
        USERCODE, 
        USERNAME, 
        ORGCODE, 
        ORGNAME, 
        INORGCODE, 
        DEPID, 
        DEPCODE, 
        DEPNAME, 
        ORGTYPE, 
        THORGCODE, 
        THORGNAME, 
        INTHORGCODE, 
        CNTID, 
        HTCODE, 
        HTNAME, 
        THCOUNT, 
        THTOTAL, 
        JYMODE, 
        JSCODE, 
        YWTYPE, 
        YWIOTYPE, 
        REMARK, 
        DATASTATUS, 
        CKCODE, 
        CKNAME, 
        THREASON, 
        WTHTOTAL, 
        PLNTHDATE, 
        STOTAL, 
        SHTYPE, 
        STLCURRTHTOTAL, 
        BILLSTATUS, 
        ADLPSTHSQTYPE
    )
    VALUES
    (
        #{billNo,jdbcType=VARCHAR},
        to_date(#{lrDate,jdbcType=DATE},'yyyy-MM-dd HH24:mi:ss'),
        #{userId,jdbcType=NUMERIC},
        #{userCode,jdbcType=VARCHAR},
        #{userName,jdbcType=VARCHAR},
        #{orgCode,jdbcType=VARCHAR},
        #{orgName,jdbcType=VARCHAR},
        #{inOrgCode,jdbcType=VARCHAR},
        #{depId,jdbcType=NUMERIC},
        #{depCode,jdbcType=VARCHAR},
        #{depName,jdbcType=VARCHAR},
        #{orgType,jdbcType=VARCHAR},
        #{thOrgCode,jdbcType=VARCHAR},
        #{thOrgnNme,jdbcType=VARCHAR},
        #{inThOrgCode,jdbcType=VARCHAR},
        #{cntId,jdbcType=NUMERIC},
        #{htCode,jdbcType=VARCHAR},
        #{htName,jdbcType=VARCHAR},
        #{thCount,jdbcType=NUMERIC},
        #{thTotal,jdbcType=NUMERIC},
        #{jyMode,jdbcType=VARCHAR},
        #{jsCode,jdbcType=VARCHAR},
        #{ywType,jdbcType=VARCHAR},
        #{ywIoType,jdbcType=VARCHAR},
        #{remark,jdbcType=VARCHAR},
        #{dataStatus,jdbcType=VARCHAR},
        #{ckCode,jdbcType=VARCHAR},
        #{ckName,jdbcType=VARCHAR},
        #{thReason,jdbcType=VARCHAR},
        #{wThTotal,jdbcType=NUMERIC},
        #{plnThDate,jdbcType=VARCHAR},
        #{sTotal,jdbcType=NUMERIC},
        #{shType,jdbcType=VARCHAR},
        #{stlCurrThTotal,jdbcType=NUMERIC},
        #{billStatus,jdbcType=VARCHAR},
        #{adlPsThSqType,jdbcType=VARCHAR}
    )
  </insert>
  
  <!-- 插入配送退货明细表 -->
  <insert id="insertRtnBodys">
    INSERT INTO TDSTRTNAPPLYBODY
    (
        BILLNO, 
        SERIALNO, 
        PLUID, 
        PLUCODE, 
        PLUNAME, 
        BARCODE, 
        EXPLUCODE, 
        SPEC, 
        UNIT, 
        THPRICE, 
        THCOUNT, 
        THTOTAL, 
        REMARK, 
        DEPID, 
        THREASON, 
        WTHPRICE, 
        WTHTOTAL, 
        PRICE, 
        STOTAL, 
        STLCURRTHPRICE, 
        STLCURRTHTOTAL
    )
    <foreach collection="bodys" item="body" separator="union all">
    (
        SELECT
          #{body.billNo,jdbcType=VARCHAR},
          #{body.serialNo,jdbcType=NUMERIC},
          #{body.pluId,jdbcType=NUMERIC},
          #{body.pluCode,jdbcType=VARCHAR},
          #{body.pluName,jdbcType=VARCHAR},
          #{body.barCode,jdbcType=VARCHAR},
          #{body.exPluCode,jdbcType=VARCHAR},
          #{body.spec,jdbcType=VARCHAR},
          #{body.unit,jdbcType=VARCHAR},
          #{body.thPrice,jdbcType=NUMERIC},
          #{body.thCount,jdbcType=NUMERIC},
          #{body.thTotal,jdbcType=NUMERIC},
          #{body.remark,jdbcType=VARCHAR},
          #{body.depId,jdbcType=NUMERIC},
          #{body.thReason,jdbcType=VARCHAR},
          #{body.wThPrice,jdbcType=NUMERIC},
          #{body.wThTotal,jdbcType=NUMERIC},
          #{body.price,jdbcType=NUMERIC},
          #{body.sTotal,jdbcType=NUMERIC},
          #{body.stlCurrThPrice,jdbcType=NUMERIC},
          #{body.stlCurrThTotal,jdbcType=NUMERIC}
        FROM DUAL
    )    
    
    </foreach>
  </insert>
  
  <!-- 查询配送退货主表-->
  <select id="getRtnHead" resultMap="BaseResultMapHead">
    Select Distinct t.BILLNO,
                t.LRDATE,
                t.USERID,
                t.USERCODE,
                t.USERNAME,
                t.GENTYPE, 
                t.ORGCODE, 
                t.ORGNAME, 
                t.INORGCODE, 
                t.DEPID, 
                t.DEPCODE, 
                t.DEPNAME, 
                t.ORGTYPE, 
                t.THORGCODE, 
                t.THORGNAME, 
                t.INTHORGCODE, 
                t.CNTID, 
                t.HTCODE, 
                t.HTNAME, 
                t.THCOUNT, 
                t.THTOTAL, 
                t.JZDATE, 
                t.JZRID, 
                t.JZRCODE, 
                t.JZRNAME,
                t.YWTYPE,
                t.REMARK, 
                t.DATASTATUS, 
                t.CKCODE, 
                t.CKNAME, 
                t.THREASON, 
                t.WTHTOTAL, 
                t.XTAXTOTAL, 
                t.PLNTHDATE,
                t.STOTAL, 
                t.STLCURRTHTOTAL,
                t.BILLSTATUS, 
                t.ADLPSTHSQTYPE
    From TDSTRTNAPPLYHEAD t Where t.BILLNO = #{billNo,jdbcType=VARCHAR}
  </select>
    
  <!-- 查询配送退货明细表 -->
  <select id="getRtnBodys" resultMap="BaseResultMapBody">
        Select Distinct t.BILLNO,
        t.SERIALNO, 
        t.PLUID, 
        t.PLUCODE, 
        t.PLUNAME, 
        t.BARCODE, 
        t.EXPLUCODE, 
        t.EXPLUNAME, 
        t.SPEC, 
        t.UNIT, 
        t.THPRICE, 
        t.PACKUNIT, 
        t.PACKQTY, 
        t.PACKCOUNT, 
        t.SGLCOUNT, 
        t.THCOUNT, 
        t.THTOTAL, 
        t.REMARK, 
        t.DEPID, 
        t.THREASON, 
        t.WTHPRICE, 
        t.WTHTOTAL, 
        t.XTAXRATE, 
        t.XTAXTOTAL, 
        t.PLNCOUNT, 
        t.ISTH, 
        t.PRICE, 
        t.STOTAL, 
        t.STLCURRTHPRICE, 
        t.STLCURRTHTOTAL, 
        t.PIECECOUNT
    From TDSTRTNAPPLYBODY t Where t.BILLNO = #{billNo,jdbcType=VARCHAR}
  </select>
  
  <!-- 删除配送退货主表 -->
  <delete id="delRtnHead">
    DELETE FROM TDSTRTNAPPLYHEAD WHERE BILLNO = #{billNo,jdbcType=VARCHAR}
  </delete>
  
  <!-- 删除配送退货明细表 -->
  <delete id="delRtnBodys">
    DELETE FROM TDSTRTNAPPLYBODY WHERE BILLNO = #{billNo,jdbcType=VARCHAR}
  </delete>
  
  <!-- 获取退货原因 -->
  <select id="getThReason" resultMap="BaseResultMapFl">
    select t.FLCODE,t.LXCODE,t.LXNAME,t.LXTYPE,t.REMARK from TBASFLCONTENT t where FLCODE = #{flCode,jdbcType=VARCHAR}
  </select>
  
  <!-- 查询退货商品 -->
  <select id="getRtnSkus" resultMap="BaseResultMapSkuEx">
    Select Distinct t.PLUID,t.PLUCODE,t.PLUNAME,t.PLUENAME,t.PLUABBRNAME,t.PLUMN,t.BARCODE,t.UNIT,t.SPEC,t.PLUWEIGHT,
    t.PLUHEIGHT,t.PLULONG,t.PLUWIDTH,t.ISMULPACKET,t.ORGCODE,t.ORGNAME,t.CGYID,t.CGYCODE,t.CGYNAME,t.CARGONO,
    t.PRODUCE,t.GRADE,t.QUALITY,t.BZDAYS,t.CLSID,t.BRANDCODE,t.JTAXCALTYPE,t.WJPRICE,t.HJPRICE,t.JTAXRATE,
    t.PRICE,t.XTAXRATE,t.ISWEIGHT,t.ISCOUTQTY,t.ISKC,t.ISCURRDAY,t.JHBFBZDAYS,t.PSBFBZDAYS,t.CXINFO,t.YWSTATUS,t.LRDATE,
    t.LRUSERCODE,t.LRUSERNAME,t.ZXDATE,t.ZXUSERCODE,t.ZXUSERNAME,t.UDP1,t.UDP2,t.UDP3,t.UDP4,t.PLUCLS,
    t.PLUMODEL,t.MATERIALCODE,t.LRORGCODE,t.LRORGNAME,t.DATASRC,t.MINTHDAYS,t.MAXTHDAYS,t.ISONLINE,t.LINEDATE,t.PLUDESC,
    t3.EXPLUCODE,t4.KYCOUNT AS KCCOUNT,t3.HCOST,t3.WCOST,t3.PLUTYPE,t3.PACKQTY
    From TSKUPLU t,TSKUPLUEX t2,TSTKLSKC t3,VSTKKYCOUNT t4
    Where t.ISACTIVE = '1' And t.ISKC='1' And t.PLUCLS != '3' 
    And t.PLUID = t2.PLUID 
    And t.PLUID = t3.PLUID 
    And t2.DEPId = t3.DEPId
    And t3.ORGCODE =  #{orgCode,jdbcType=VARCHAR} 
    And t3.DEPId = #{depId,jdbcType=NUMERIC} 
    And t3.CKCODE = #{ckCode,jdbcType=VARCHAR}
    And t.PLUID = t4.PLUID
    And t4.KYCOUNT > 0
  </select>
  
  <!-- 查询多部门退货商品 -->
  <select id="getOtherDeptRtnSkus" resultMap="BaseResultMapSkuEx">
    Select Distinct t.PLUID,t.PLUCODE,t.PLUNAME,t.PLUENAME,t.PLUABBRNAME,t.PLUMN,t.BARCODE,t.UNIT,t.SPEC,t.PLUWEIGHT,
    t.PLUHEIGHT,t.PLULONG,t.PLUWIDTH,t.ISMULPACKET,t.ORGCODE,t.ORGNAME,t.CGYID,t.CGYCODE,t.CGYNAME,t.CARGONO,
    t.PRODUCE,t.GRADE,t.QUALITY,t.BZDAYS,t.CLSID,t.BRANDCODE,t.JTAXCALTYPE,t.WJPRICE,t.HJPRICE,t.JTAXRATE,
    t.PRICE,t.XTAXRATE,t.ISWEIGHT,t.ISCOUTQTY,t.ISKC,t.ISCURRDAY,t.JHBFBZDAYS,t.PSBFBZDAYS,t.CXINFO,t.YWSTATUS,t.LRDATE,
    t.LRUSERCODE,t.LRUSERNAME,t.ZXDATE,t.ZXUSERCODE,t.ZXUSERNAME,t.UDP1,t.UDP2,t.UDP3,t.UDP4,t.PLUCLS,
    t.PLUMODEL,t.MATERIALCODE,t.LRORGCODE,t.LRORGNAME,t.DATASRC,t.MINTHDAYS,t.MAXTHDAYS,t.ISONLINE,t.LINEDATE,t.PLUDESC,
    t3.EXPLUCODE,t4.KYCOUNT AS KCCOUNT,t3.HCOST,t3.WCOST,t3.PLUTYPE,t3.PACKQTY
    From TSKUPLU t,TSKUPLUOTHERDEPT t2,TSTKLSKC t3,VSTKKYCOUNT t4
    Where t.ISACTIVE = '1' And t.ISKC='1' And t.PLUCLS != '3' 
    And t.PLUID = t2.PLUID 
    And t.PLUID = t3.PLUID 
    And t2.DEPId = t3.DEPId
    And t3.ORGCODE =  #{orgCode,jdbcType=VARCHAR} 
    And t3.DEPId = #{depId,jdbcType=NUMERIC} 
    And t3.CKCODE = #{ckCode,jdbcType=VARCHAR}
    And t.PLUID = t4.PLUID
    And t4.KYCOUNT > 0
  </select>
  
  <!-- 调用存储过程进行单据记账 -->
  <select id="execRtnAccountProcedure" statementType="CALLABLE" parameterType="java.util.HashMap">
    <![CDATA[
     {
       CALL PSSY_DB.sStk_LetsGo_ORA
       (
         #{ps_BillNo,mode=IN,jdbcType=VARCHAR}, to_date(#{pd_Date,jdbcType=VARCHAR},'yyyy-MM-dd HH24:mi:ss'), 
         #{ps_UserId,mode=IN,jdbcType=NUMERIC}, #{ps_UserCode,mode=IN,jdbcType=VARCHAR}, 
         #{ps_UserName,mode=IN,jdbcType=VARCHAR}, 
         #{pi_Result,mode=OUT,jdbcType=NUMERIC}, #{ps_Message,mode=OUT,jdbcType=VARCHAR}
       )
     }
    ]]>
  </select>
</mapper>