<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.addlove.service.goods.dao.StkDbDao">
  <resultMap id="BaseResultMapHead" type="com.addlove.service.goods.model.StkDbHeadModel">
    <result column="BILLNO" jdbcType="VARCHAR" property="billNo" />
    <result column="LRDATE" jdbcType="TIMESTAMP" property="lrDate" />
    <result column="USERID" jdbcType="NUMERIC" property="userId" />
    <result column="USERCODE" jdbcType="VARCHAR" property="userCode" />
    <result column="USERNAME" jdbcType="VARCHAR" property="userName" />
    <result column="JZDATE" jdbcType="TIMESTAMP" property="jzDate" />
    <result column="JZRID" jdbcType="NUMERIC" property="jzrId" />
    <result column="JZRCODE" jdbcType="VARCHAR" property="jzrCode" />
    <result column="JZRNAME" jdbcType="VARCHAR" property="jzrName" />
    <result column="RPTDATE" jdbcType="VARCHAR" property="rptDate" />
    <result column="PRNTIMES" jdbcType="NUMERIC" property="prnTimes" />
    <result column="PRNDATE" jdbcType="TIMESTAMP" property="prnDate" />
    <result column="TIMEMARK" jdbcType="NUMERIC" property="timeMark" />
    <result column="GENTYPE" jdbcType="VARCHAR" property="genType" />
    <result column="YWBILLNO" jdbcType="VARCHAR" property="ywBillNo" />
    <result column="EMPID" jdbcType="NUMERIC" property="empId" />
    <result column="EMPCODE" jdbcType="VARCHAR" property="empCode" />
    <result column="EMPNAME" jdbcType="VARCHAR" property="empName" />
    <result column="ORGCODE" jdbcType="VARCHAR" property="orgCode" />
    <result column="ORGNAME" jdbcType="VARCHAR" property="orgName" />
    <result column="DEPID" jdbcType="NUMERIC" property="depId" />
    <result column="DEPCODE" jdbcType="VARCHAR" property="depCode" />
    <result column="DEPNAME" jdbcType="VARCHAR" property="depName" />
    <result column="SHORGCODE" jdbcType="VARCHAR" property="shOrgCode" />
    <result column="SHORGNAME" jdbcType="VARCHAR" property="shOrgName" />
    <result column="SHDEPID" jdbcType="NUMERIC" property="shDepId" />
    <result column="SHDEPCODE" jdbcType="VARCHAR" property="shDepCode" />
    <result column="SHDEPNAME" jdbcType="VARCHAR" property="shDepName" />
    <result column="CKCODE" jdbcType="VARCHAR" property="ckCode" />
    <result column="CKNAME" jdbcType="VARCHAR" property="ckName" />
    <result column="SHCKCODE" jdbcType="VARCHAR" property="shCkCode" />
    <result column="SHCKNAME" jdbcType="VARCHAR" property="shCkName" />
    <result column="ISPSTASK" jdbcType="VARCHAR" property="isPsTask" />
    <result column="DBCOUNT" jdbcType="NUMERIC" property="dbCount" />
    <result column="WCOST" jdbcType="NUMERIC" property="wCost" />
    <result column="HCOST" jdbcType="NUMERIC" property="hCost" />
    <result column="CWDATE" jdbcType="VARCHAR" property="cwDate" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="INORGCODE" jdbcType="VARCHAR" property="inOrgCode" />
    <result column="INSHORGCODE" jdbcType="VARCHAR" property="inShOrgCode" />
    <result column="DATASTATUS" jdbcType="VARCHAR" property="dataStatus" />
    <result column="YWTYPE" jdbcType="VARCHAR" property="ywType" />
    <result column="YWSTATUS" jdbcType="VARCHAR" property="ywStatus" />
    <result column="ISDEPUNION" jdbcType="VARCHAR" property="isDepUnion" />
    <result column="RHCOST" jdbcType="NUMERIC" property="rhCost" />
    <result column="RWCOST" jdbcType="NUMERIC" property="rwCost" />
    <result column="WLAREACODE" jdbcType="VARCHAR" property="wlAreaCode" />
    <result column="WLAREANAME" jdbcType="VARCHAR" property="wlAreaName" />
    <result column="SHWLAREACODE" jdbcType="VARCHAR" property="shWlAreaCode" />
    <result column="SHWLAREANAME" jdbcType="VARCHAR" property="shWlAreaName" />
    <result column="STOTAL" jdbcType="NUMERIC" property="sTotal" />
    <result column="ORIGINTYPE" jdbcType="VARCHAR" property="originType" />
    <result column="TJDATE" jdbcType="TIMESTAMP" property="tjDate" />
    <result column="TJRID" jdbcType="NUMERIC" property="tjrId" />
    <result column="TJRCODE" jdbcType="VARCHAR" property="tjrCode" />
    <result column="TJRNAME" jdbcType="VARCHAR" property="tjrName" />
    <result column="ISCHECKED" jdbcType="VARCHAR" property="isChecked" />
    <result column="CHKUSERID" jdbcType="NUMERIC" property="chkUserId" />
    <result column="CHKUSERCODE" jdbcType="VARCHAR" property="chkUserCode" />
    <result column="CHKUSERNAME" jdbcType="VARCHAR" property="chkUserName" />
    <result column="CHKDATE" jdbcType="TIMESTAMP" property="chkDate" />
    <result column="MDBILLNO" jdbcType="VARCHAR" property="mdBillNo" />
    <result column="REFBILLNO" jdbcType="VARCHAR" property="refBillNo" />
    <result column="REFSHDEPID" jdbcType="NUMERIC" property="refShDepId" />
    <result column="REFSHDEPCODE" jdbcType="VARCHAR" property="refShDepCode" />
    <result column="REFSHDEPNAME" jdbcType="VARCHAR" property="refShDepName" />
  </resultMap>
  
  <resultMap id="BaseResultMapBody" type="com.addlove.service.goods.model.StkDbBodyModel">
    <id column="BILLNO" jdbcType="VARCHAR" property="billNo" />
    <id column="SERIALNO" jdbcType="NUMERIC" property="serialNo" />
    <result column="PLUID" jdbcType="NUMERIC" property="pluId" />
    <result column="EXPLUCODE" jdbcType="VARCHAR" property="exPluCode" />
    <result column="EXPLUNAME" jdbcType="VARCHAR" property="exPluName" />
    <result column="PLUCODE" jdbcType="VARCHAR" property="pluCode" />
    <result column="PLUNAME" jdbcType="VARCHAR" property="pluName" />
    <result column="BARCODE" jdbcType="VARCHAR" property="barCode" />
    <result column="SPEC" jdbcType="VARCHAR" property="spec" />
    <result column="UNIT" jdbcType="VARCHAR" property="unit" />
    <result column="PACKUNIT" jdbcType="VARCHAR" property="packUnit" />
    <result column="PACKQTY" jdbcType="NUMERIC" property="packQty" />
    <result column="PACKCOUNT" jdbcType="NUMERIC" property="packCount" />
    <result column="SGLCOUNT" jdbcType="NUMERIC" property="sglCount" />
    <result column="DBCOUNT" jdbcType="NUMERIC" property="dbCount" />
    <result column="PLUTYPE" jdbcType="VARCHAR" property="pluType" />
    <result column="HJPRICE" jdbcType="NUMERIC" property="hjPrice" />
    <result column="WJPRICE" jdbcType="NUMERIC" property="wjPrice" />
    <result column="PRICE" jdbcType="NUMERIC" property="price" />
    <result column="JTAXRATE" jdbcType="NUMERIC" property="jTaxRate" />
    <result column="HCOST" jdbcType="NUMERIC" property="hCost" />
    <result column="WCOST" jdbcType="NUMERIC" property="wCost" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="SHDEPID" jdbcType="NUMERIC" property="shDepId" />
    <result column="SHDEPCODE" jdbcType="VARCHAR" property="shDepCode" />
    <result column="SHDEPNAME" jdbcType="VARCHAR" property="shDepName" />
    <result column="RHCOST" jdbcType="NUMERIC" property="rhCost" />
    <result column="RWCOST" jdbcType="NUMERIC" property="rwCost" />
    <result column="OUTKWCODE" jdbcType="VARCHAR" property="outKwCode" />
    <result column="INKWCODE" jdbcType="VARCHAR" property="inKwCode" />
    <result column="STOTAL" jdbcType="NUMERIC" property="sTotal" />
    <result column="RHJPRICE" jdbcType="NUMERIC" property="rhJPrice" />
    <result column="RWJPRICE" jdbcType="NUMERIC" property="rwJPrice" />
    <result column="CARGONO" jdbcType="VARCHAR" property="carGoNo" />
    <result column="TOSERIALNO" jdbcType="NUMERIC" property="toSerialNo" />
  </resultMap>
  
  <sql id="Base_Column_List_Head">
    BILLNO, LRDATE, USERID, USERCODE, USERNAME, JZDATE, JZRID, JZRCODE, JZRNAME, RPTDATE, 
    PRNTIMES, PRNDATE, TIMEMARK, GENTYPE, YWBILLNO, EMPID, EMPCODE, EMPNAME, ORGCODE, 
    ORGNAME, DEPID, DEPCODE, DEPNAME, SHORGCODE, SHORGNAME, SHDEPID, SHDEPCODE, SHDEPNAME, 
    CKCODE, CKNAME, SHCKCODE, SHCKNAME, ISPSTASK, DBCOUNT, WCOST, HCOST, CWDATE, REMARK, 
    INORGCODE, INSHORGCODE, DATASTATUS, YWTYPE, YWSTATUS, ISDEPUNION, RHCOST, RWCOST, 
    WLAREACODE, WLAREANAME, SHWLAREACODE, SHWLAREANAME, STOTAL, ORIGINTYPE, TJDATE, TJRID, 
    TJRCODE, TJRNAME, ISCHECKED, CHKUSERID, CHKUSERCODE, CHKUSERNAME, CHKDATE, MDBILLNO, 
    REFBILLNO, REFSHDEPID, REFSHDEPCODE, REFSHDEPNAME
  </sql>
  
  <sql id="Base_Column_List_Body">
    BILLNO, SERIALNO, PLUID, EXPLUCODE, EXPLUNAME, PLUCODE, PLUNAME, BARCODE, SPEC, UNIT, 
    PACKUNIT, PACKQTY, PACKCOUNT, SGLCOUNT, DBCOUNT, PLUTYPE, HJPRICE, WJPRICE, PRICE, 
    JTAXRATE, HCOST, WCOST, REMARK, SHDEPID, SHDEPCODE, SHDEPNAME, RHCOST, RWCOST, OUTKWCODE, 
    INKWCODE, STOTAL, RHJPRICE, RWJPRICE, CARGONO, TOSERIALNO
  </sql>
  
  <!-- 分页查询调拨信息 -->
  <select id="queryDbPage" resultMap="BaseResultMapHead">
    Select Distinct t.BILLNO,
                t.LRDATE,
                t.USERID,
                t.USERCODE,
                t.USERNAME,
                t.JZDATE,
                t.JZRID,
                t.JZRCODE,
                t.JZRNAME,
                t.EMPID,
                t.EMPCODE,
                t.EMPNAME,
                t.ORGCODE,
                t.ORGNAME,
                t.DEPID,
                t.DEPCODE,
                t.DEPNAME,
                t.SHORGCODE,
                t.SHORGNAME,
                t.SHDEPID,
                t.SHDEPCODE,
                t.SHDEPNAME,
                t.CKCODE,
                t.CKNAME,
                t.SHCKCODE,
                t.SHCKNAME,
                t.ISPSTASK,
                t.DBCOUNT,
                t.WCOST,
                t.HCOST,
                t.REMARK,
                t.INORGCODE,
                t.INSHORGCODE,
                t.DATASTATUS,
                t.YWTYPE,
                t.YWSTATUS,
                t.RHCOST,
                t.RWCOST,
                t.STOTAL,
                t.ISCHECKED,
                t.CHKUSERID,
                t.CHKUSERCODE,
                t.CHKUSERNAME,
                t.CHKDATE
    From TSTKDBHEAD t
    Where t.YWTYPE = '1804'
    <if test="queryModel.billNo != '' and queryModel.billNo != null">
        and t.BILLNO LIKE CONCAT(#{queryModel.billNo,jdbcType=VARCHAR},'%')
    </if>
    <if test="queryModel.startDate != '' and queryModel.startDate != null">
        and t.LRDATE &gt;= to_date(#{queryModel.startDate,jdbcType=VARCHAR},'yyyy-MM-dd HH24:mi:ss')
    </if>
    <if test="queryModel.endDate != '' and queryModel.endDate != null">
        and t.LRDATE &lt;= to_date(#{queryModel.endDate,jdbcType=VARCHAR},'yyyy-MM-dd HH24:mi:ss')
    </if>
    <if test="queryModel.dataStatus != null and queryModel.dataStatus == '' ">
        and t.DATASTATUS = #{queryModel.dataStatus,jdbcType=VARCHAR}
    </if>
    <if test="queryModel.dbType != null and queryModel.dbType == 1 ">
        and t.ORGCODE = t.SHORGCODE
    </if>
    <if test="queryModel.dbType != null and queryModel.dbType == 2 ">
        and t.ORGCODE != t.SHORGCODE
    </if>
     <if test="queryModel.shOrgCode != null and queryModel.shOrgCode == '' ">
        and t.SHORGCODE = #{queryModel.shOrgCode,jdbcType=VARCHAR}
    </if>
    and t.ORGCODE = #{queryModel.orgCode,jdbcType=VARCHAR}
    Order By t.LRDATE Desc
  </select>
  
  <!-- 插入调拨主表 -->
  <insert id="insertStkDbHead" parameterType="com.addlove.service.goods.model.StkDbHeadModel">
    INSERT INTO TSTKDBHEAD
    (
        BILLNO, 
        LRDATE, 
        USERID, 
        USERCODE, 
        USERNAME,
        EMPID, 
        EMPCODE, 
        EMPNAME, 
        ORGCODE, 
        ORGNAME, 
        DEPID, 
        DEPCODE, 
        DEPNAME, 
        SHORGCODE, 
        SHORGNAME, 
        SHDEPID, 
        SHDEPCODE, 
        SHDEPNAME, 
        CKCODE, 
        CKNAME, 
        SHCKCODE, 
        SHCKNAME, 
        DBCOUNT, 
        WCOST, 
        HCOST,
        REMARK, 
        INORGCODE, 
        INSHORGCODE, 
        DATASTATUS, 
        YWTYPE, 
        RHCOST, 
        RWCOST, 
        STOTAL
    )
    VALUES
    (
        #{billNo,jdbcType=VARCHAR},
        to_date(#{lrDate,jdbcType=DATE},'yyyy-MM-dd HH24:mi:ss'),
        #{userId,jdbcType=NUMERIC},
        #{userCode,jdbcType=VARCHAR},
        #{userName,jdbcType=VARCHAR},
        #{empId,jdbcType=NUMERIC},
        #{empCode,jdbcType=VARCHAR},
        #{empName,jdbcType=VARCHAR},
        #{orgCode,jdbcType=VARCHAR},
        #{orgName,jdbcType=VARCHAR},
        #{depId,jdbcType=NUMERIC},
        #{depCode,jdbcType=VARCHAR},
        #{depName,jdbcType=VARCHAR},
        #{shOrgCode,jdbcType=VARCHAR},
        #{shOrgName,jdbcType=VARCHAR},
        #{shDepId,jdbcType=NUMERIC},
        #{shDepCode,jdbcType=VARCHAR},
        #{shDepName,jdbcType=VARCHAR},
        #{ckCode,jdbcType=VARCHAR},
        #{ckName,jdbcType=VARCHAR},
        #{shCkCode,jdbcType=VARCHAR},
        #{shCkName,jdbcType=VARCHAR},
        #{dbCount,jdbcType=NUMERIC},
        #{wCost,jdbcType=NUMERIC},
        #{hCost,jdbcType=NUMERIC},
        #{remark,jdbcType=VARCHAR},
        #{inOrgCode,jdbcType=VARCHAR},
        #{inShOrgCode,jdbcType=VARCHAR},
        #{dataStatus,jdbcType=VARCHAR},
        #{ywType,jdbcType=VARCHAR},
        #{rhCost,jdbcType=NUMERIC},
        #{rwCost,jdbcType=NUMERIC},
        #{sTotal,jdbcType=NUMERIC}
    )
  </insert>
  
  <!-- 插入调拨明细表 -->
  <insert id="insertStkDbBody" parameterType="com.addlove.service.goods.model.StkDbBodyModel">
    INSERT INTO TSTKDBBODY
    (
        BILLNO, 
        SERIALNO, 
        PLUID, 
        EXPLUCODE, 
        EXPLUNAME, 
        PLUCODE, 
        PLUNAME, 
        BARCODE, 
        SPEC, 
        UNIT, 
        PACKUNIT, 
        PACKQTY, 
        PACKCOUNT, 
        SGLCOUNT, 
        DBCOUNT, 
        HJPRICE, 
        WJPRICE, 
        PRICE, 
        JTAXRATE, 
        HCOST, 
        WCOST, 
        REMARK, 
        SHDEPID, 
        SHDEPCODE, 
        SHDEPNAME, 
        RHCOST, 
        RWCOST, 
        STOTAL, 
        RHJPRICE, 
        RWJPRICE, 
        CARGONO, 
        TOSERIALNO
    )
    <foreach collection="bodys" item="body" separator="union all">
    (
         SELECT
          #{body.billNo,jdbcType=VARCHAR},
          #{body.serialNo,jdbcType=NUMERIC},
          #{body.pluId,jdbcType=VARCHAR},
          #{body.exPluCode,jdbcType=VARCHAR},
          #{body.exPluName,jdbcType=VARCHAR},
          #{body.pluCode,jdbcType=VARCHAR},
          #{body.pluName,jdbcType=VARCHAR},
          #{body.barCode,jdbcType=VARCHAR},
          #{body.spec,jdbcType=VARCHAR},
          #{body.unit,jdbcType=VARCHAR},
          #{body.packUnit,jdbcType=NUMERIC},
          #{body.packQty,jdbcType=NUMERIC},
          #{body.packCount,jdbcType=NUMERIC},
          #{body.sglCount,jdbcType=NUMERIC},
          #{body.dbCount,jdbcType=NUMERIC},
          #{body.hjPrice,jdbcType=NUMERIC},
          #{body.wjPrice,jdbcType=NUMERIC},
          #{body.price,jdbcType=NUMERIC},
          #{body.jTaxRate,jdbcType=NUMERIC},
          #{body.hCost,jdbcType=NUMERIC},
          #{body.wCost,jdbcType=NUMERIC},
          #{body.remark,jdbcType=VARCHAR},
          #{body.shDepId,jdbcType=NUMERIC},
          #{body.shDepCode,jdbcType=VARCHAR},
          #{body.shDepName,jdbcType=VARCHAR},
          #{body.rhCost,jdbcType=NUMERIC},
          #{body.rwCost,jdbcType=NUMERIC},
          #{body.sTotal,jdbcType=NUMERIC},
          #{body.rhJPrice,jdbcType=NUMERIC},
          #{body.rwJPrice,jdbcType=NUMERIC},
          #{body.carGoNo,jdbcType=VARCHAR},
          #{body.toSerialNo,jdbcType=NUMERIC}
         FROM DUAL
    )
    </foreach>
  </insert>
  
  <!-- 删除调拨主表 -->
  <delete id="deleteStkDbHead" parameterType="java.lang.String">
    DELETE FROM TSTKDBHEAD WHERE BILLNO = #{billNo,jdbcType=VARCHAR}
  </delete>
  
  <!-- 删除调拨明细表 -->
  <delete id="deleteStkDbBody" parameterType="java.lang.String">
    DELETE FROM TSTKDBBODY WHERE BILLNO = #{billNo,jdbcType=VARCHAR}
  </delete>
  
  <!-- 查询调拨详情 -->
  <select id="queryDbDetailByBillNo" resultType="java.util.HashMap">
    Select Distinct t.BILLNO,
                t.LRDATE,
                t.USERID,
                t.USERCODE,
                t.USERNAME,
                t.JZDATE,
                t.JZRID,
                t.JZRCODE,
                t.JZRNAME,
                t.EMPID,
                t.EMPCODE,
                t.EMPNAME,
                t.ORGCODE,
                t.ORGNAME,
                t.DEPID,
                t.DEPCODE,
                t.DEPNAME,
                t.SHORGCODE,
                t.SHORGNAME,
                t.SHDEPID,
                t.SHDEPCODE,
                t.SHDEPNAME,
                t.CKCODE,
                t.CKNAME,
                t.SHCKCODE,
                t.SHCKNAME,
                t.ISPSTASK,
                t.DBCOUNT,
                t.WCOST,
                t.HCOST,
                t.REMARK,
                t.INORGCODE,
                t.INSHORGCODE,
                t.DATASTATUS,
                t.YWTYPE,
                t.YWSTATUS,
                t.RHCOST,
                t.RWCOST,
                t.STOTAL,
                t.ISCHECKED,
                t.CHKUSERID,
                t.CHKUSERCODE,
                t.CHKUSERNAME,
                t.CHKDATE,
                t1.SERIALNO,
                t1.PLUID,
                t1.EXPLUCODE,
                t1.EXPLUNAME,
                t1.PLUCODE,
                t1.PLUNAME,
                t1.BARCODE,
                t1.SPEC,
                t1.UNIT,
                t1.PACKUNIT,
                t1.PACKQTY,
                t1.PACKCOUNT,
                t1.SGLCOUNT,
                t1.DBCOUNT AS DBCOUNT2,
                t1.PLUTYPE,
                t1.HJPRICE,
                t1.WJPRICE,
                t1.PRICE,
                t1.JTAXRATE,
                t1.HCOST AS HCOST2,
                t1.WCOST AS WCOST2,
                t1.REMARK AS REMARK2,
                t1.SHDEPID AS SHDEPID2,
                t1.SHDEPCODE AS SHDEPCODE2,
                t1.SHDEPNAME AS SHDEPNAME2,
                t1.RHCOST AS RHCOST2,
                t1.RWCOST AS RWCOST2,
                t1.OUTKWCODE,
                t1.INKWCODE,
                t1.STOTAL AS STOTAL2,
                t1.RHJPRICE,
                t1.RWJPRICE,
                t1.CARGONO,
                t1.TOSERIALNO
    From TSTKDBHEAD t Left Join TSTKDBBODY t1 On t.BILLNO = t1.BILLNO
    Where t.BILLNO = #{billNo,jdbcType=VARCHAR}
    Order By t1.SERIALNO
  </select>
</mapper>