<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.addlove.service.goods.dao.OrdThApplyDao">
  <resultMap id="BaseResultMapHead" type="com.addlove.service.goods.model.OrdThApplyHeadModel">
    <id column="BILLNO" jdbcType="VARCHAR" property="billNo" />
    <result column="LRDATE" jdbcType="TIMESTAMP" property="lrDate" />
    <result column="USERID" jdbcType="NUMERIC" property="userId" />
    <result column="USERCODE" jdbcType="VARCHAR" property="userCode" />
    <result column="USERNAME" jdbcType="VARCHAR" property="userName" />
    <result column="ISNEEDTJWL" jdbcType="VARCHAR" property="isNeedTjwl" />
    <result column="TJDATE" jdbcType="TIMESTAMP" property="tjDate" />
    <result column="TJRID" jdbcType="NUMERIC" property="tjrId" />
    <result column="TJRCODE" jdbcType="VARCHAR" property="tjrCode" />
    <result column="TJRNAME" jdbcType="VARCHAR" property="tjrName" />
    <result column="JZDATE" jdbcType="TIMESTAMP" property="jzDate" />
    <result column="JZRID" jdbcType="NUMERIC" property="jzrId" />
    <result column="JZRCODE" jdbcType="VARCHAR" property="jzrCode" />
    <result column="JZRNAME" jdbcType="VARCHAR" property="jzrName" />
    <result column="JZTYPE" jdbcType="VARCHAR" property="jzType" />
    <result column="RPTDATE" jdbcType="VARCHAR" property="rptDate" />
    <result column="PRNTIMES" jdbcType="NUMERIC" property="prnTimes" />
    <result column="PRNDATE" jdbcType="TIMESTAMP" property="prnDate" />
    <result column="TIMEMARK" jdbcType="NUMERIC" property="timeMark" />
    <result column="YWTYPE" jdbcType="VARCHAR" property="ywType" />
    <result column="YWIOTYPE" jdbcType="VARCHAR" property="ywIoType" />
    <result column="ZDRID" jdbcType="NUMERIC" property="zdrId" />
    <result column="ZDRCODE" jdbcType="VARCHAR" property="zdrCode" />
    <result column="ZDRNAME" jdbcType="VARCHAR" property="zdrName" />
    <result column="BILLTYPE" jdbcType="VARCHAR" property="billType" />
    <result column="REFBILLTYPE" jdbcType="VARCHAR" property="refBillType" />
    <result column="REFBILLNO" jdbcType="VARCHAR" property="refBillNo" />
    <result column="ORGCODE" jdbcType="VARCHAR" property="orgCode" />
    <result column="ORGNAME" jdbcType="VARCHAR" property="orgName" />
    <result column="INORGCODE" jdbcType="VARCHAR" property="inOrgCode" />
    <result column="ZBORGCODE" jdbcType="VARCHAR" property="zbOrgCode" />
    <result column="ZBORGNAME" jdbcType="VARCHAR" property="zbOrgName" />
    <result column="DEPID" jdbcType="NUMERIC" property="depId" />
    <result column="DEPCODE" jdbcType="VARCHAR" property="depCode" />
    <result column="DEPNAME" jdbcType="VARCHAR" property="depName" />
    <result column="SUPCODE" jdbcType="VARCHAR" property="supCode" />
    <result column="SUPNAME" jdbcType="VARCHAR" property="supName" />
    <result column="CNTID" jdbcType="NUMERIC" property="cntId" />
    <result column="HTCODE" jdbcType="VARCHAR" property="htCode" />
    <result column="HTNAME" jdbcType="VARCHAR" property="htName" />
    <result column="JYMODE" jdbcType="VARCHAR" property="jyMode" />
    <result column="JSCODE" jdbcType="VARCHAR" property="jsCode" />
    <result column="PSCNTID" jdbcType="NUMERIC" property="psCntId" />
    <result column="PSHTCODE" jdbcType="VARCHAR" property="psHtCode" />
    <result column="PSHTNAME" jdbcType="VARCHAR" property="psHtName" />
    <result column="PSJYMODE" jdbcType="VARCHAR" property="psJyMode" />
    <result column="PSJSCODE" jdbcType="VARCHAR" property="psJsCode" />
    <result column="CKCODE" jdbcType="VARCHAR" property="ckCode" />
    <result column="CKNAME" jdbcType="VARCHAR" property="ckName" />
    <result column="BGRID" jdbcType="NUMERIC" property="bgrId" />
    <result column="BGYCODE" jdbcType="VARCHAR" property="bgyCode" />
    <result column="BGYNAME" jdbcType="VARCHAR" property="bgyName" />
    <result column="ISZDJPRICE" jdbcType="VARCHAR" property="isZdjPrice" />
    <result column="ISZT" jdbcType="VARCHAR" property="isZt" />
    <result column="DATASTATUS" jdbcType="VARCHAR" property="dataStatus" />
    <result column="THCOUNT" jdbcType="NUMERIC" property="thCount" />
    <result column="HCOST" jdbcType="NUMERIC" property="hCost" />
    <result column="WCOST" jdbcType="NUMERIC" property="wCost" />
    <result column="JTAXTOTAL" jdbcType="NUMERIC" property="jTaxTotal" />
    <result column="STOTAL" jdbcType="NUMERIC" property="sTotal" />
    <result column="CJTOTAL" jdbcType="NUMERIC" property="cjTotal" />
    <result column="PSCOST" jdbcType="NUMERIC" property="psCost" />
    <result column="THREASON" jdbcType="VARCHAR" property="thReason" />
    <result column="CKMODE" jdbcType="VARCHAR" property="ckMode" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="CHECKSTATUS" jdbcType="VARCHAR" property="checkStatus" />
    <result column="APPLYSTATUS" jdbcType="VARCHAR" property="applyStatus" />
    <result column="CLSCODE" jdbcType="VARCHAR" property="clsCode" />
    <result column="CLSNAME" jdbcType="VARCHAR" property="clsName" />
    <result column="CHECKUSERID" jdbcType="NUMERIC" property="checkUserId" />
    <result column="CHECKUSERCODE" jdbcType="VARCHAR" property="checkUserCode" />
    <result column="CHECKUSERNAME" jdbcType="VARCHAR" property="checkUserName" />
    <result column="CHECKDATE" jdbcType="TIMESTAMP" property="checkDate" />
    <result column="THBILLNO" jdbcType="VARCHAR" property="thBillNo" />
    <result column="ISCREATETHBILL" jdbcType="VARCHAR" property="isCreateThBill" />
    <result column="CREATEUSERID" jdbcType="NUMERIC" property="createUserId" />
    <result column="CREATEUSERCODE" jdbcType="VARCHAR" property="createUserCode" />
    <result column="CREATEUSERNAME" jdbcType="VARCHAR" property="createUserName" />
    <result column="CREATEDATE" jdbcType="TIMESTAMP" property="createDate" />
    <result column="CREATEBILLNO" jdbcType="VARCHAR" property="createBillNo" />
    <result column="SUPCKCODE" jdbcType="VARCHAR" property="supCkCode" />
    <result column="SUPCKNAME" jdbcType="VARCHAR" property="supCkName" />
    <result column="SUPDEPID" jdbcType="NUMERIC" property="supDepId" />
    <result column="SUPDEPCODE" jdbcType="VARCHAR" property="supDepCode" />
    <result column="SUPDEPNAME" jdbcType="VARCHAR" property="supdepname" />
  </resultMap>
  
  <resultMap id="BaseResultMapBody" type="com.addlove.service.goods.model.OrdThApplyBodyModel">
    <id column="BILLNO" jdbcType="VARCHAR" property="billNo" />
    <id column="SERIALNO" jdbcType="NUMERIC" property="serialNo" />
    <result column="PLUID" jdbcType="NUMERIC" property="pluId" />
    <result column="PLUCODE" jdbcType="VARCHAR" property="pluCode" />
    <result column="PLUNAME" jdbcType="VARCHAR" property="pluName" />
    <result column="EXPLUCODE" jdbcType="VARCHAR" property="exPluCode" />
    <result column="EXPLUNAME" jdbcType="VARCHAR" property="exPluName" />
    <result column="BARCODE" jdbcType="VARCHAR" property="barCode" />
    <result column="SPEC" jdbcType="VARCHAR" property="spec" />
    <result column="UNIT" jdbcType="VARCHAR" property="unit" />
    <result column="CARGONO" jdbcType="VARCHAR" property="carGoNo" />
    <result column="PLUTYPE" jdbcType="VARCHAR" property="pluType" />
    <result column="DEPID" jdbcType="NUMERIC" property="depId" />
    <result column="DEPCODE" jdbcType="VARCHAR" property="depCode" />
    <result column="DEPNAME" jdbcType="VARCHAR" property="depName" />
    <result column="HJPRICE" jdbcType="NUMERIC" property="hjPrice" />
    <result column="WJPRICE" jdbcType="NUMERIC" property="wjPrice" />
    <result column="JTAXRATE" jdbcType="NUMERIC" property="jtaxrate" />
    <result column="PRICE" jdbcType="NUMERIC" property="price" />
    <result column="PSPRICE" jdbcType="NUMERIC" property="psPrice" />
    <result column="PACKUNIT" jdbcType="VARCHAR" property="packUnit" />
    <result column="PACKQTY" jdbcType="NUMERIC" property="packQty" />
    <result column="PACKCOUNT" jdbcType="NUMERIC" property="packCount" />
    <result column="SGLCOUNT" jdbcType="NUMERIC" property="sglCount" />
    <result column="THCOUNT" jdbcType="NUMERIC" property="thCount" />
    <result column="HCOST" jdbcType="NUMERIC" property="hCost" />
    <result column="WCOST" jdbcType="NUMERIC" property="wCost" />
    <result column="JTAXTOTAL" jdbcType="NUMERIC" property="jTaxTotal" />
    <result column="STOTAL" jdbcType="NUMERIC" property="sTotal" />
    <result column="CJTOTAL" jdbcType="NUMERIC" property="cjTotal" />
    <result column="CJRATE" jdbcType="NUMERIC" property="cjRate" />
    <result column="PSCOST" jdbcType="NUMERIC" property="psCost" />
    <result column="REMARK" jdbcType="VARCHAR" property="remark" />
    <result column="HJSTOTAL" jdbcType="NUMERIC" property="hjsTotal" />
    <result column="WJSTOTAL" jdbcType="NUMERIC" property="wjsTotal" />
    <result column="THREASON" jdbcType="VARCHAR" property="thReason" />
    <result column="CHECKINFO" jdbcType="VARCHAR" property="checkInfo" />
    <result column="CHECKUSERID" jdbcType="NUMERIC" property="checkUserId" />
    <result column="CHECKUSERCODE" jdbcType="VARCHAR" property="checkUserCode" />
    <result column="CHECKUSERNAME" jdbcType="VARCHAR" property="checkUserName" />
    <result column="CHECKDATE" jdbcType="TIMESTAMP" property="checkDate" />
    <result column="CLSCODE" jdbcType="VARCHAR" property="clsCode" />
    <result column="CLSNAME" jdbcType="VARCHAR" property="clsName" />
    <result column="ISSELECT" jdbcType="VARCHAR" property="isSelect" />
    <result column="ETPCODE" jdbcType="VARCHAR" property="etpCode" />
    <result column="DSTTYPE" jdbcType="VARCHAR" property="dstType" />
    <result column="SQThCOUNT" jdbcType="NUMERIC" property="sqThCount" />
  </resultMap>
  
  <sql id="Base_Column_List_head">
    BILLNO, LRDATE, USERID, USERCODE, USERNAME, ISNEEDTJWL, TJDATE, TJRID, TJRCODE, TJRNAME, 
    JZDATE, JZRID, JZRCODE, JZRNAME, JZTYPE, RPTDATE, PRNTIMES, PRNDATE, TIMEMARK, YWTYPE, 
    YWIOTYPE, ZDRID, ZDRCODE, ZDRNAME, BILLTYPE, REFBILLTYPE, REFBILLNO, ORGCODE, ORGNAME, 
    INORGCODE, ZBORGCODE, ZBORGNAME, DEPID, DEPCODE, DEPNAME, SUPCODE, SUPNAME, CNTID, 
    HTCODE, HTNAME, JYMODE, JSCODE, PSCNTID, PSHTCODE, PSHTNAME, PSJYMODE, PSJSCODE, 
    CKCODE, CKNAME, BGRID, BGYCODE, BGYNAME, ISZDJPRICE, ISZT, DATASTATUS, THCOUNT, HCOST, 
    WCOST, JTAXTOTAL, STOTAL, CJTOTAL, PSCOST, THREASON, CKMODE, REMARK, CHECKSTATUS, 
    APPLYSTATUS, CLSCODE, CLSNAME, CHECKUSERID, CHECKUSERCODE, CHECKUSERNAME, CHECKDATE, 
    THBILLNO, ISCREATETHBILL, CREATEUSERID, CREATEUSERCODE, CREATEUSERNAME, CREATEDATE, 
    CREATEBILLNO, SUPCKCODE, SUPCKNAME, SUPDEPID, SUPDEPCODE, SUPDEPNAME
  </sql>
  
  <sql id="Base_Column_List_body">
    BILLNO, SERIALNO, PLUID, PLUCODE, PLUNAME, EXPLUCODE, EXPLUNAME, BARCODE, SPEC, UNIT, 
    CARGONO, PLUTYPE, DEPID, DEPCODE, DEPNAME, HJPRICE, WJPRICE, JTAXRATE, PRICE, PSPRICE, 
    PACKUNIT, PACKQTY, PACKCOUNT, SGLCOUNT, THCOUNT, HCOST, WCOST, JTAXTOTAL, STOTAL, 
    CJTOTAL, CJRATE, PSCOST, REMARK, HJSTOTAL, WJSTOTAL, THREASON, CHECKINFO, CHECKUSERID, 
    CHECKUSERCODE, CHECKUSERNAME, CHECKDATE, CLSCODE, CLSNAME, ISSELECT, ETPCODE, DSTTYPE,
    SQThCOUNT
  </sql>
  
  <!-- 分页查询差异单信息 -->
  <select id="queryOrdThHeadModelByPage" resultMap="BaseResultMapHead">
    Select Distinct t.BILLNO,
                t.ORGCODE,
                t.ORGNAME,
                t.TJDATE,
                t.TJRCODE,
                t.TJRNAME,
                t.APPLYSTATUS,
                t.THCOUNT,
                t.CHECKUSERID,
                t.CHECKUSERCODE,
                t.CHECKUSERNAME,
                t.SUPCKCODE,
                t.SUPCKNAME,
                t.SUPDEPID,
                t.SUPDEPCODE,
                t.SUPDEPNAME,
                t.CREATEBILLNO,
                t.REFBILLNO,
                t.DEPID,
                t.DEPCODE,
                t.DEPNAME
    From TORDTHAPPLYHEAD t
    Where t.ORGCODE = #{queryModel.orgCode,jdbcType=VARCHAR}
    <if test="queryModel.billNo != '' and queryModel.billNo != null">
        and t.BILLNO = #{queryModel.billNo,jdbcType=VARCHAR}
    </if>
    <if test="queryModel.startDate != '' and queryModel.startDate != null">
        and t.TJDATE &gt;= to_date(#{queryModel.startDate,jdbcType=VARCHAR},'yyyy-MM-dd HH24:mi:ss')
    </if>
    <if test="queryModel.endDate != '' and queryModel.endDate != null">
        and t.TJDATE &lt;= to_date(#{queryModel.endDate,jdbcType=VARCHAR},'yyyy-MM-dd HH24:mi:ss')
    </if>
    <if test="queryModel.applyStatus != '' and queryModel.applyStatus != null">
        and t.APPLYSTATUS = #{queryModel.applyStatus,jdbcType=VARCHAR}
    </if>
    <if test="queryModel.tjrName != '' and queryModel.tjrName != null">
        and t.TJRNAME like CONCAT('%',#{queryModel.tjrName,jdbcType=VARCHAR})
    </if>
    Order By t.APPLYSTATUS,t.TJDATE Desc
  </select>
  
  <!-- 将配送差异插入退货申请单:头部信息 -->
  <insert id="insertOrdThApplyHead" parameterType="com.addlove.service.goods.model.OrdThApplyHeadModel">
    INSERT INTO TORDTHAPPLYHEAD
    (
        BILLNO,
        REFBILLNO,
        ORGCODE,
        ORGNAME, 
        INORGCODE,
        ZBORGCODE,
        ZBORGNAME,
        SUPCODE,
        SUPNAME,
        CNTID,
        CKCODE,
        CKNAME,
        THCOUNT,
        HCOST, 
        WCOST,
        JTAXTOTAL,
        STOTAL,
        CJTOTAL,
        PSCOST,
        YWTYPE,
        APPLYSTATUS,
        TJDATE,
        TJRID,
        TJRCODE,
        TJRNAME,
        DEPID,
        DEPCODE,
        DEPNAME
    )
    VALUES
    (
        #{billNo,jdbcType=VARCHAR},
        #{refBillNo,jdbcType=VARCHAR},
        #{orgCode,jdbcType=VARCHAR},
        #{orgName,jdbcType=VARCHAR},
        #{inOrgCode,jdbcType=VARCHAR},
        #{zbOrgCode,jdbcType=VARCHAR},
        #{zbOrgName,jdbcType=VARCHAR},
        #{supCode,jdbcType=VARCHAR},
        #{supName,jdbcType=VARCHAR},
        #{cntId,jdbcType=NUMERIC},
        #{ckCode,jdbcType=VARCHAR},
        #{ckName,jdbcType=VARCHAR},
        #{thCount,jdbcType=NUMERIC},
        #{hCost,jdbcType=NUMERIC},
        #{wCost,jdbcType=NUMERIC},
        #{jTaxTotal,jdbcType=NUMERIC},
        #{sTotal,jdbcType=NUMERIC},
        #{cjTotal,jdbcType=NUMERIC},
        #{psCost,jdbcType=NUMERIC},
        #{ywType,jdbcType=VARCHAR},
        #{applyStatus,jdbcType=VARCHAR},
        to_date(#{tjDate,jdbcType=DATE},'yyyy-MM-dd HH24:mi:ss'),
        #{tjrId,jdbcType=NUMERIC},
        #{tjrCode,jdbcType=VARCHAR},
        #{tjrName,jdbcType=VARCHAR},
        #{depId,jdbcType=NUMERIC},
        #{depCode,jdbcType=VARCHAR},
        #{depName,jdbcType=VARCHAR}
    )
  </insert>
  
  <!-- 将配送差异插入退货申请单:明细信息 -->
  <insert id="insertOrdThApplyBody">
    INSERT INTO TORDTHAPPLYBODY
    (
        BILLNO,
        SERIALNO,
        PLUID,
        PLUCODE,
        PLUNAME,
        EXPLUCODE,
        BARCODE,
        SPEC,
        UNIT, 
        CARGONO,
        DEPID,
        DEPCODE,
        DEPNAME,
        PSPRICE, 
        PACKUNIT,
        PACKQTY,
        PACKCOUNT,
        SGLCOUNT,
        THCOUNT,
        HCOST,
        WCOST,
        JTAXTOTAL,
        PSCOST,
        STOTAL, 
        CJTOTAL,
        CJRATE,
        HJSTOTAL,
        WJSTOTAL,
        SQThCOUNT
    )
    <foreach collection="bodys" item="body" separator="union all">
    (
      SELECT
        #{body.billNo,jdbcType=VARCHAR},
        #{body.serialNo,jdbcType=NUMERIC},
        #{body.pluId,jdbcType=NUMERIC},
        #{body.pluCode,jdbcType=VARCHAR},
        #{body.pluName,jdbcType=VARCHAR},
        #{body.exPluCode,jdbcType=VARCHAR},
        #{body.barCode,jdbcType=VARCHAR},
        #{body.spec,jdbcType=VARCHAR},
        #{body.unit,jdbcType=VARCHAR},
        #{body.carGoNo,jdbcType=VARCHAR},
        #{body.depId,jdbcType=NUMERIC},
        #{body.depCode,jdbcType=VARCHAR},
        #{body.depName,jdbcType=VARCHAR},
        #{body.psPrice,jdbcType=NUMERIC},
        #{body.packUnit,jdbcType=VARCHAR},
        #{body.packQty,jdbcType=NUMERIC},
        #{body.packCount,jdbcType=NUMERIC},
        #{body.sglCount,jdbcType=NUMERIC},
        #{body.thCount,jdbcType=NUMERIC},
        #{body.hCost,jdbcType=NUMERIC},
        #{body.wCost,jdbcType=NUMERIC},
        #{body.jTaxTotal,jdbcType=NUMERIC},
        #{body.psCost,jdbcType=NUMERIC},
        #{body.sTotal,jdbcType=NUMERIC},
        #{body.cjTotal,jdbcType=NUMERIC},
        #{body.cjRate,jdbcType=NUMERIC},
        #{body.hjsTotal,jdbcType=NUMERIC},
        #{body.wjsTotal,jdbcType=NUMERIC},
        #{body.sqThCount,jdbcType=NUMERIC}
      FROM DUAL
    )
    </foreach>
  </insert>
  
  <!-- 根据退货差异单号查询退货单详情 -->
  <select id="queryThBodysByBillNo" resultType="java.util.HashMap">
    Select t.BILLNO,
           t.ORGCODE,
           t.ORGNAME,
           t.TJDATE,
           t.TJRCODE,
           t.TJRNAME,
           t.APPLYSTATUS,
           t.THCOUNT,
           t.CHECKUSERID,
           t.CHECKUSERCODE,
           t.CHECKUSERNAME,
           t.SUPCKCODE,
           t.SUPCKNAME,
           t.SUPDEPID,
           t.SUPDEPCODE,
           t.SUPDEPNAME,
           t.CREATEBILLNO,
           t.REFBILLNO,
           t1.SERIALNO,
           t1.PLUCODE,
           t1.PLUNAME,
           t1.CHECKINFO AS CHECKINFO2,
           t1.CHECKUSERID AS CHECKUSERID2,
           t1.CHECKUSERCODE AS CHECKUSERCODE2,
           t1.CHECKUSERNAME AS CHECKUSERNAME2,
           t1.CHECKDATE AS CHECKDATE2,
           t1.SQThCOUNT AS SQThCOUNT2,
           t1.THCOUNT AS THCOUNT2
    From TORDTHAPPLYHEAD t Left Join TORDTHAPPLYBODY t1 On t.BILLNO = t1.BILLNO
    Where t.BILLNO = #{billNo,jdbcType=VARCHAR}
    Order By t1.SERIALNO
  </select>
  
  <!-- 调用存储过程生成单据号  -->
  <select id="getBillNoByCallProcedure" statementType="CALLABLE" parameterType="java.util.HashMap">
    <![CDATA[
       {CALL sSysGetBillNo(#{ps_BillType,mode=IN,jdbcType=VARCHAR}, #{ps_BillNo,mode=OUT,jdbcType=VARCHAR})}
    ]]>
  </select>
</mapper>